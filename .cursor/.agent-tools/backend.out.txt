
> marketing-co-pilot-backend@1.0.0 start
> node dist/index.js

🛒 CommerceAudienceService: CSV mode (fallback)
📊 CensusDataService: CSV mode (fallback)
📊 CensusDataService: CSV mode (fallback)
✅ Loaded commerce baseline from cache (calculated 10/9/2025, 8:00:53 PM)
📊 Loading user-level overlap data from CSV: /Users/cgeorge/Deal-Library/deal-library-backend/data/199_Audience_Overlap_Data.csv
✅ Loaded user-level overlap data from CSV
   📊 199 segments with overlap data
   🔗 970 total overlap relationships
   ☕ Coffee overlaps: Household Supplies (52%), Exercise & Fitness (50%), Alcoholic Beverages (46%)
⚠️  Missing environment variables (development): GOOGLE_APPS_SCRIPT_URL
Some features may be limited without these variables.
📁 Loaded persisted state from previous session
🔄 PersistenceService initialized - context will be preserved across restarts
⚠️  GOOGLE_APPS_SCRIPT_URL not configured - Apps Script integration will be unavailable
📊 CensusDataService: Supabase mode enabled
✅ Gemini AI service initialized
🔄 Initializing embedding service...
✅ Vector embeddings service initialized
🚀 Sovrn Marketing Co-Pilot Backend running on port 3002
📊 Environment: development
🔗 Health check: http://localhost:3002/health
📋 API endpoints:
   GET    /api/deals
   GET    /api/deals/:id
   POST   /api/deals
   PUT    /api/deals/:id
   POST   /api/custom-deal-request
   POST   /api/deals/search
   POST   /api/audience-insights
   POST   /api/market-sizing
   POST   /api/geographic-insights
   POST   /api/unified-search
   POST   /api/census/load
   POST   /api/census/query
   POST   /api/census/zip-codes
   POST   /api/census/search-location
   GET    /api/census/status
   POST   /api/commerce-audiences/load
   GET    /api/commerce-audiences/segments
   POST   /api/commerce-audiences/search-zip-codes
   POST   /api/commerce-audiences/zip-codes-data
   GET    /api/commerce-audiences/status
   POST   /api/audience-geo-analysis/generate
   GET    /api/audience-geo-analysis/segments
   GET    /api/audience-geo-analysis/status
   POST   /api/audience-geo-analysis/export-pdf
✅ Embedding service initialized
🎯 Generating Audience Insights Report for: Audio
   Include Commercial ZIPs: NO (default: residential only)

================================================================================
🎯 Generating Audience Insights Report for: "Audio"
   Include Commercial ZIPs: NO (residential only)
================================================================================

📊 Calculating commerce audience baseline (SEGMENT MEDIAN approach)...
   This represents the median "online shopper" across all 196 segments
   Analyzing 0 commerce segments individually...
   ✅ Calculated medians for 0 segments
💾 Saved commerce baseline to cache
✅ Commerce baseline calculated successfully (SEGMENT MEDIAN approach)
   Method: Median of 0 segment medians
   
   📊 BASELINE VALUES (Median "Online Shopper"):
      Income: $0
         Range: $0 - $0
      Education: 0%
         Range: 0.0% - 0.0%
      Age: 0 years
      Home Ownership: 0%
      Household Size: 0 people
      Home Value: $0
   
   🆕 LIFESTYLE BASELINE:
      Self-Employed: 0%
      Married: 0%
      Dual Income: 0%
      Avg Commute: 0 min
      Charitable: 0%
      STEM: 0%
   
   ⏱️  Calculation time: 0.0s
📊 Commerce baseline: $0, 0% edu (4ms)
🔍 Getting top geo concentration for: "Audio"
⚠️ Commerce audience data not loaded
⚠️  No audience data found for segment: "Audio"
📍 Found 0 high-concentration ZIP codes (0ms)
📊 Aggregating demographics for 0 ZIP codes
📊 Loading US Census data from CSV...
📈 Processing 41552 census records...
✅ Census data loaded successfully:
   📍 33782 zip codes
   🏛️ 56 states
   👥 Average population: 9,933
   💰 Average income: $69,157
   Median HHI: 70420 (+0.0% vs national) - Middle
   Top age bracket: 25-44, Median: 38.5
   Education (Bachelor's+): 35.0% (+0.0% vs national) - College-Educated
   Family: Couples & Small Families (avg 2.5 people, +0.0% vs national)
   Location: Suburban Homeowners (65% homeowners, median home value $300000)
   Six-figure households: 0%
   🆕 LIFESTYLE: SelfEmp 0.0%, Married 0.0%, DualInc 0.0%, Commute 0min, Charity 0.0%, STEM 0.0%
📊 Aggregated demographics for 0 ZIPs (501ms)
🗺️  Identified top markets:  (0ms)
🔗 Calculating behavioral overlaps for: "Audio"
   ⚡ Using pre-calculated overlaps (instant lookup!)
   ✅ Found top 5 overlapping segments
      1. Tablet Computers: 27.0% overlap
      2. Magazines & Newspapers: 23.0% overlap
      3. Cameras & Optics: 21.0% overlap
      4. Baby & Toddler: 18.0% overlap
      5. Pasta & Noodles: 17.0% overlap
🔗 Identified 5 overlapping segments (1ms)
📊 vs Commerce: Income +Infinity%, Education +Infinity%
✨ Generating strategic insights with Gemini for: "Audio"
✅ Gemini service initialized for Audience Insights
📄 Raw Gemini response length: 3525 chars
✅ Parsed JSON from code block
✨ Generated strategic insights with Gemini (35864ms)
📝 Generating executive summary with Gemini
📝 Generated executive summary (7996ms)

👤 Generating AI persona for: "Audio"
✅ AI Persona: "The Connected Sound Seeker" 🎧
👤 Generated AI persona: "The Connected Sound Seeker" 🎧 (10540ms)
💾 Report cached for "Audio"
⏱️  TOTAL REPORT GENERATION TIME: 54.91s

🔍 AppsScriptService.getAllDeals called, baseUrl: null
⚠️  Apps Script URL not configured - returning empty deals array
⚠️  No deals available for matching
[0mPOST /api/audience-insights/generate [32m200[0m 54919.327 ms - 6866[0m
[0mGET /health [32m200[0m 0.653 ms - 193[0m
[0mGET /api/census/status [32m200[0m 0.580 ms - 58[0m
[0mGET /api/commerce-audiences/segments [32m200[0m 2.488 ms - 40[0m
📊 Loading census data...
📊 Loading US Census data from Supabase...
🔌 Initializing Supabase client...
✅ Supabase client initialized
📈 Processing 41351 census records from Supabase...
✅ Loaded 41351 ZIP codes from Supabase
   States: 62
   Avg Population: 8,087
   Avg Income: $56,218
[0mPOST /api/census/load [32m200[0m 6494.074 ms - 523[0m
📊 Loading commerce audience data...
📊 Loading Commerce Audience segments data from CSV...
✅ Commerce audience data loaded successfully:
   📍 2071130 ZIP codes
   🎯 196 audience segments
   📊 Average weight: 1803
[0mPOST /api/commerce-audiences/load [32m200[0m 2486.576 ms - 21250[0m
[0mGET /api/census/status [32m200[0m 0.539 ms - 61[0m
[0mGET /api/commerce-audiences/segments [32m200[0m 866.937 ms - 20607[0m
📊 Loading commerce audience data...
📊 Loading Commerce Audience segments data from CSV...
✅ Commerce audience data loaded successfully:
   📍 2071130 ZIP codes
   🎯 196 audience segments
   📊 Average weight: 1803
[0mPOST /api/commerce-audiences/load [32m200[0m 2589.851 ms - 21250[0m
📊 Loading commerce audience data...
📊 Loading Commerce Audience segments data from CSV...
✅ Commerce audience data loaded successfully:
   📍 2071130 ZIP codes
   🎯 196 audience segments
   📊 Average weight: 1803
[0mPOST /api/commerce-audiences/load [32m200[0m 2352.591 ms - 21250[0m
